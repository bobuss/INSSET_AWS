<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>TP_Aws</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="css/github.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<p><a href="index.html">retour</a></p>
<h2 id="la-doc-en-ligne">La doc en ligne</h2>
<p><a href="http://docs.aws.amazon.com/cli/latest/reference/"
class="uri">http://docs.aws.amazon.com/cli/latest/reference/</a></p>
<h2 id="installer-aws-cli">Installer AWS CLI</h2>
<p>Pour info : <a href="https://github.com/aws/aws-cli"
class="uri">https://github.com/aws/aws-cli</a></p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">$</span> sudo apt-get install <span class="at">-y</span> python-pip<span class="kw">)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sudo pip install awscli</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws configure</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cat ~/.aws/config</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">[default]</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="ex">aws_access_key_id</span> = <span class="op">&lt;</span>access key id<span class="op">&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="ex">aws_secret_access_key</span> = <span class="op">&lt;</span>secret access key<span class="op">&gt;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="ex">region</span> = us-west-1</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws ec2 describe-regions</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Regions&quot;</span><span class="ex">:</span> [</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">{</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Endpoint&quot;</span><span class="ex">:</span> <span class="st">&quot;ec2.eu-west-1.amazonaws.com&quot;</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;RegionName&quot;</span><span class="ex">:</span> <span class="st">&quot;eu-west-1&quot;</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="ex">},</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="kw">{</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Endpoint&quot;</span><span class="ex">:</span> <span class="st">&quot;ec2.sa-east-1.amazonaws.com&quot;</span>,</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;RegionName&quot;</span><span class="ex">:</span> <span class="st">&quot;sa-east-1&quot;</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>        <span class="ex">},</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>        <span class="kw">{</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Endpoint&quot;</span><span class="ex">:</span> <span class="st">&quot;ec2.us-west-1.amazonaws.com&quot;</span>,</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;RegionName&quot;</span><span class="ex">:</span> <span class="st">&quot;us-west-1&quot;</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        <span class="ex">},</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>        <span class="kw">{</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Endpoint&quot;</span><span class="ex">:</span> <span class="st">&quot;ec2.ap-northeast-1.amazonaws.com&quot;</span>,</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;RegionName&quot;</span><span class="ex">:</span> <span class="st">&quot;ap-northeast-1&quot;</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>        <span class="ex">},</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">{</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Endpoint&quot;</span><span class="ex">:</span> <span class="st">&quot;ec2.us-west-2.amazonaws.com&quot;</span>,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;RegionName&quot;</span><span class="ex">:</span> <span class="st">&quot;us-west-2&quot;</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        <span class="ex">},</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>        <span class="kw">{</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Endpoint&quot;</span><span class="ex">:</span> <span class="st">&quot;ec2.us-west-1.amazonaws.com&quot;</span>,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;RegionName&quot;</span><span class="ex">:</span> <span class="st">&quot;us-west-1&quot;</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>        <span class="ex">},</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>        <span class="kw">{</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Endpoint&quot;</span><span class="ex">:</span> <span class="st">&quot;ec2.ap-southeast-1.amazonaws.com&quot;</span>,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;RegionName&quot;</span><span class="ex">:</span> <span class="st">&quot;ap-southeast-1&quot;</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>        <span class="ex">},</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>        <span class="kw">{</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;Endpoint&quot;</span><span class="ex">:</span> <span class="st">&quot;ec2.ap-southeast-2.amazonaws.com&quot;</span>,</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;RegionName&quot;</span><span class="ex">:</span> <span class="st">&quot;ap-southeast-2&quot;</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="ex">]</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Toutes les commande s’addressent par défaut à la région renseignée
dans la config. Le flag <code>--region</code> permet néanmoins de
surcharger ce comportement.</p>
<h3 id="pratique-lautocompletion">Pratique : l’autocompletion</h3>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">complete</span> <span class="at">-C</span> aws_completer aws</span></code></pre></div>
<h3 id="alternative-saws-aws-cli-on-steroids">Alternative : SAWS (AWS
cli on Steroids)</h3>
<p><a href="https://github.com/donnemartin/saws"
class="uri">https://github.com/donnemartin/saws</a></p>
<h2 id="on-commence-par-se-créer-une-paire-de-clés">On commence par se
créer une paire de clés</h2>
<p>On appelle l’API afin de se créer une paire de clés. On lui donne un
nom qui doit être unique sur le compte AWS et par région. Ici c’est
<code>MyKeyPair</code>, merci de faire preuve d’originalité ici…</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws ec2 create-key-pair <span class="at">--key-name</span> MyKeyPair</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;KeyPair&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;KeyMaterial&quot;</span><span class="fu">:</span> <span class="st">&quot;-----BEGIN RSA PRIVATE KEY-----</span><span class="ch">\n</span><span class="st">MIIEogIBAAKCAQEAgDbY5Hzlv+wP4nTVXkwRHemd3/OLo/O6u+kI2UloHqN6mZLP+XoFcEAmNmM0</span><span class="ch">\n</span><span class="st">3sA/mfv0B9fKktSUqnAEPlygS35P1xJhUXqvdFhh4m7mF+D7naPPHWcg581sdhfqEQU1uMcFq+14</span><span class="ch">\n</span><span class="st">fTgkQRCLkoNNsf3c4O1KxhJ6etHFxcqr/V104PnOPGlWWni+kIMyMP/+CvzzKCZkkL/EUk6LDH4T</span><span class="ch">\n</span><span class="st">HqG4nDmEd4u0oNPakWd1nX26hfYN61IhkNedtqU9CnJPHBFRbl+BZbllB4ZkxYn6QHi5t7J0Lj26</span><span class="ch">\n</span><span class="st">ruq6URfKLIO4ZOcZ35ZARSFB4nYtU6tbw78sE0jJqZ6ibwHyPhw8fwIDAQABAoIBAEGs1pjjqUQQ</span><span class="ch">\n</span><span class="st">BWr4cbslt7bczfPDawoGdOaATfoPcfgPwWMdIs8lw9dl5K0DUDexvmJ//tZtoORpY+WSD3pqM+m3</span><span class="ch">\n</span><span class="st">v+npDlSQRYORKkK0j8Q3iGuNVzA2fVJ/lUlAorMpOgV2XN9eetOZiGiTswrPm2LLKPNGWYDwQjDb</span><span class="ch">\n</span><span class="st">dzUDxem300kdPZcGiiW6OIIF39s0cHdYSurLlfFGBgT1YZUQQI8AyAZOA/uI5gzlXHo6pmOGc61Y</span><span class="ch">\n</span><span class="st">nIGqAYV3k8eCsEag9XMyrAih1DiuSMEUzwXImPHuFQTB/Z28rhPPbdQ3mioHJBRDn3wGRz233q44</span><span class="ch">\n</span><span class="st">5ZHGsi/XdeA2oNAIIg+20LFVhdECgYEA1jnngYbv30JPO/IAQdAjM4r4bV5adqQRhsZFeFcjI1pL</span><span class="ch">\n</span><span class="st">6JXHnuBBN69z5liCICRLfWHtEwUXDbt/9tZmmG6Qp5SZdPSncmAbzsDuA7nKKrnhdoNDw4V8MN++</span><span class="ch">\n</span><span class="st">+Hn+T0ezJp8dXNB3EnDiLvO71sunJMTAIxKjPejFG6SsqALWrSMCgYEAmTdB1XgOCdgl3P+8/Og0</span><span class="ch">\n</span><span class="st">M3qwZGTbX641ug30QBgYmDKA3D+vLRBeGtxU+j/y41Ah2W016amtdM7KgMTVdB0ZjSR70TmaETrD</span><span class="ch">\n</span><span class="st">kW449q0J/UrH9DmcOpUf8qVS8QwG/fhH/VElLKiWGitulHrZPVSSBomLpJKOUzHnSGl6ZO+m7vUC</span><span class="ch">\n</span><span class="st">gYA5YVUjGpORh19VvSJYfnmPSr/z+3vbn2KaaO0eqKhexcbjS4smgQa29aXjov1nwpD9yocHuytL</span><span class="ch">\n</span><span class="st">oFdMNG1SkvroCCN6cjWPqzKHlKGsGc2O2C8N4Wb7Lfvv016Bi5uUfK39wEzLGYNrSxUqYlqD1BS3</span><span class="ch">\n</span><span class="st">AoQ8YLec04ZIOzmL3wbFZQKBgHAeZYim3+8IQzzj0BJqgbiiMW5l97qeqyZJi9FTULwfSPjjiXc6</span><span class="ch">\n</span><span class="st">oQKa9XxjS4RYYUzQhEFHL21o3fs5DtJ3cPk+F3VV545wKCjGNd0dZ0/5ZzUq605bThOsM3O9T2iO</span><span class="ch">\n</span><span class="st">RW/z73YssBraaYMyGsKsnmc2Q//cV1Y+EHeG6E/wp4H5AoGAT/jpdHo6hjYDd6z8WJT6zuyecT39</span><span class="ch">\n</span><span class="st">l4oB72CO6PCJXLLtTj85brYLP6mZyecOvD4a7Zr97NcmA4aUZtv7ERHoHSRhyOm1ePHaV2i7JFfo</span><span class="ch">\n</span><span class="st">Hvc01+KCAJPx8txqvHvqKfNm2aMeok7FVPSB1vbdgnBRnGJiqYQ5GgrxH0Gc3DXTG7A=</span><span class="ch">\n</span><span class="st">-----END RSA PRIVATE KEY-----&quot;</span><span class="fu">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;KeyName&quot;</span><span class="fu">:</span> <span class="st">&quot;MyKeyPair&quot;</span><span class="fu">,</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">&quot;KeyFingerprint&quot;</span><span class="fu">:</span> <span class="st">&quot;24:86:89:71:68:af:3e:00:49:15:96:06:2d:f3:2e:96:da:66:6e:d8&quot;</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> vi my-key-pair.pem</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">copier</span> la clé. Attention aux retours chariots<span class="kw">)</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cat my-key-pair.pem</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="ex">-----BEGIN</span> RSA PRIVATE KEY-----</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="ex">MIIEogIBAAKCAQEAgDbY5Hzlv+wP4nTVXkwRHemd3/OLo/O6u+kI2UloHqN6mZLP+XoFcEAmNmM0</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="ex">3sA/mfv0B9fKktSUqnAEPlygS35P1xJhUXqvdFhh4m7mF+D7naPPHWcg581sdhfqEQU1uMcFq+14</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="ex">fTgkQRCLkoNNsf3c4O1KxhJ6etHFxcqr/V104PnOPGlWWni+kIMyMP/+CvzzKCZkkL/EUk6LDH4T</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="ex">HqG4nDmEd4u0oNPakWd1nX26hfYN61IhkNedtqU9CnJPHBFRbl+BZbllB4ZkxYn6QHi5t7J0Lj26</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="ex">ruq6URfKLIO4ZOcZ35ZARSFB4nYtU6tbw78sE0jJqZ6ibwHyPhw8fwIDAQABAoIBAEGs1pjjqUQQ</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="ex">BWr4cbslt7bczfPDawoGdOaATfoPcfgPwWMdIs8lw9dl5K0DUDexvmJ//tZtoORpY+WSD3pqM+m3</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="ex">v+npDlSQRYORKkK0j8Q3iGuNVzA2fVJ/lUlAorMpOgV2XN9eetOZiGiTswrPm2LLKPNGWYDwQjDb</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="ex">dzUDxem300kdPZcGiiW6OIIF39s0cHdYSurLlfFGBgT1YZUQQI8AyAZOA/uI5gzlXHo6pmOGc61Y</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="ex">nIGqAYV3k8eCsEag9XMyrAih1DiuSMEUzwXImPHuFQTB/Z28rhPPbdQ3mioHJBRDn3wGRz233q44</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="ex">5ZHGsi/XdeA2oNAIIg+20LFVhdECgYEA1jnngYbv30JPO/IAQdAjM4r4bV5adqQRhsZFeFcjI1pL</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="ex">6JXHnuBBN69z5liCICRLfWHtEwUXDbt/9tZmmG6Qp5SZdPSncmAbzsDuA7nKKrnhdoNDw4V8MN++</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="ex">+Hn+T0ezJp8dXNB3EnDiLvO71sunJMTAIxKjPejFG6SsqALWrSMCgYEAmTdB1XgOCdgl3P+8/Og0</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a><span class="ex">M3qwZGTbX641ug30QBgYmDKA3D+vLRBeGtxU+j/y41Ah2W016amtdM7KgMTVdB0ZjSR70TmaETrD</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="ex">kW449q0J/UrH9DmcOpUf8qVS8QwG/fhH/VElLKiWGitulHrZPVSSBomLpJKOUzHnSGl6ZO+m7vUC</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="ex">gYA5YVUjGpORh19VvSJYfnmPSr/z+3vbn2KaaO0eqKhexcbjS4smgQa29aXjov1nwpD9yocHuytL</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="ex">oFdMNG1SkvroCCN6cjWPqzKHlKGsGc2O2C8N4Wb7Lfvv016Bi5uUfK39wEzLGYNrSxUqYlqD1BS3</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="ex">AoQ8YLec04ZIOzmL3wbFZQKBgHAeZYim3+8IQzzj0BJqgbiiMW5l97qeqyZJi9FTULwfSPjjiXc6</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="ex">oQKa9XxjS4RYYUzQhEFHL21o3fs5DtJ3cPk+F3VV545wKCjGNd0dZ0/5ZzUq605bThOsM3O9T2iO</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="ex">RW/z73YssBraaYMyGsKsnmc2Q//cV1Y+EHeG6E/wp4H5AoGAT/jpdHo6hjYDd6z8WJT6zuyecT39</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="ex">l4oB72CO6PCJXLLtTj85brYLP6mZyecOvD4a7Zr97NcmA4aUZtv7ERHoHSRhyOm1ePHaV2i7JFfo</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a><span class="ex">Hvc01+KCAJPx8txqvHvqKfNm2aMeok7FVPSB1vbdgnBRnGJiqYQ5GgrxH0Gc3DXTG7A=</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="ex">-----END</span> RSA PRIVATE KEY-----</span></code></pre></div>
<p>Pour l’astuce, et éviter les soucis de copier/coller, autant parser
le json directement. Avec une commande comme <code>jq</code> (<a
href="https://stedolan.github.io/jq/"
class="uri">https://stedolan.github.io/jq/</a>), cela donne:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws ec2 create-key-pair <span class="at">--key-name</span> MyKeyPair <span class="kw">|</span> <span class="ex">jq</span> <span class="at">-r</span> <span class="st">&quot;.KeyMaterial&quot;</span> <span class="op">&gt;</span> my-key-pair.pem</span></code></pre></div>
<p>Important : MyKeyPair est le nom de notre clé. Rien à voir avec le
ficher en local qui est la clé publique. Lors des appels à l’API, on
passera le nom de la clé (donc MyKeyPair). Lors de la connexion aux
instances, on passera à la commande ssh le ficher de la clé publique
(donc le fichier <code>my-key-pair.pem</code>).</p>
<p>Nous avons notre clé publique en local. Pour pouvoir l’utiliser, on
va la protéger.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> chmod 600 my-key-pair.pem</span></code></pre></div>
<h2 id="question-sécurité-les-vpc-virtual-private-cloud">Question
sécurité : les VPC (Virtual Private Cloud)</h2>
<p>Les instances AWS sont déployé par défaut dans un VPC (un VPN dans le
cloud d’amazon, en quelque sorte).</p>
<p>Voyons ça …</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws ec2 describe-vpcs <span class="at">--region</span> us-west-1</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Vpcs&quot;</span><span class="ex">:</span> [</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">{</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;VpcId&quot;</span><span class="ex">:</span> <span class="st">&quot;vpc-ed37d589&quot;</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;InstanceTenancy&quot;</span><span class="ex">:</span> <span class="st">&quot;default&quot;</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;State&quot;</span><span class="ex">:</span> <span class="st">&quot;available&quot;</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;DhcpOptionsId&quot;</span><span class="ex">:</span> <span class="st">&quot;dopt-e1391184&quot;</span>,</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;CidrBlock&quot;</span><span class="ex">:</span> <span class="st">&quot;172.31.0.0/16&quot;</span>,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;IsDefault&quot;</span><span class="ex">:</span> true</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">]</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>OK, plus intéressant pour nous, les subnets :</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws ec2 describe-subnets</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Subnets&quot;</span><span class="ex">:</span> [</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">{</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;VpcId&quot;</span><span class="ex">:</span> <span class="st">&quot;vpc-ed37d589&quot;</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;CidrBlock&quot;</span><span class="ex">:</span> <span class="st">&quot;172.31.16.0/20&quot;</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;MapPublicIpOnLaunch&quot;</span><span class="ex">:</span> true,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;DefaultForAz&quot;</span><span class="ex">:</span> true,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;State&quot;</span><span class="ex">:</span> <span class="st">&quot;available&quot;</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;AvailabilityZone&quot;</span><span class="ex">:</span> <span class="st">&quot;us-west-1b&quot;</span>,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;SubnetId&quot;</span><span class="ex">:</span> <span class="st">&quot;subnet-fb4eff9f&quot;</span>,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;AvailableIpAddressCount&quot;</span><span class="ex">:</span> 4091</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="ex">},</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>        <span class="kw">{</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;VpcId&quot;</span><span class="ex">:</span> <span class="st">&quot;vpc-ed37d589&quot;</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;CidrBlock&quot;</span><span class="ex">:</span> <span class="st">&quot;172.31.0.0/20&quot;</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;MapPublicIpOnLaunch&quot;</span><span class="ex">:</span> true,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;DefaultForAz&quot;</span><span class="ex">:</span> true,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;State&quot;</span><span class="ex">:</span> <span class="st">&quot;available&quot;</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;AvailabilityZone&quot;</span><span class="ex">:</span> <span class="st">&quot;us-west-1a&quot;</span>,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;SubnetId&quot;</span><span class="ex">:</span> <span class="st">&quot;subnet-3b30f463&quot;</span>,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>            <span class="st">&quot;AvailableIpAddressCount&quot;</span><span class="ex">:</span> 4091</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">}</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    <span class="ex">]</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="kw">}</span></span></code></pre></div>
<p>Ces subnets nous seront demandés lors de la manipulation de nos
instances.</p>
<h2 id="lancement-de-notre-première-instance">Lancement de notre
première instance</h2>
<h3 id="choix-dune-ami-amazon-machine-image">Choix d’une AMI (Amazon
Machine Image)</h3>
<p>Comme son nom l’indique, c’est l’image que l’on utilise lors du
lancement de l’instance. Elle est spécifique :</p>
<ul>
<li>à la région,</li>
<li>au système d’exploitation,</li>
<li>à l’architecture (32 ou 64bits),</li>
<li>aux permissions</li>
<li>et au type de stockage du <em>root device</em>.</li>
</ul>
<p>Pour faire son choix en Ubuntu : <a
href="https://cloud-images.ubuntu.com/locator/ec2/"
class="uri">https://cloud-images.ubuntu.com/locator/ec2/</a></p>
<p>Donc, pour une instance t2.micro, le <em>root device</em> est EBS en
Hardware Virtual Machine (HVM), on choisit l’image pour la région
us-west-1 d’une ubuntu 16.04 (yakkety) : <em>ami-a4175cc4</em>.</p>
<p>D’où la commande :</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws ec2 run-instances <span class="at">--image-id</span> ami-a4175cc4 <span class="at">--instance-type</span> t2.nano <span class="at">--region</span> us-west-1 <span class="at">--key</span> MyKeyPair <span class="at">--subnet-id</span> subnet-3b30f463</span></code></pre></div>
<div class="sourceCode" id="cb11"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;OwnerId&quot;</span><span class="fu">:</span> <span class="st">&quot;511122800347&quot;</span><span class="fu">,</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;ReservationId&quot;</span><span class="fu">:</span> <span class="st">&quot;r-eaf7f258&quot;</span><span class="fu">,</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Groups&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Instances&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;Monitoring&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;State&quot;</span><span class="fu">:</span> <span class="st">&quot;disabled&quot;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;PublicDnsName&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;RootDeviceType&quot;</span><span class="fu">:</span> <span class="st">&quot;ebs&quot;</span><span class="fu">,</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;State&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;Code&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;Name&quot;</span><span class="fu">:</span> <span class="st">&quot;pending&quot;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;EbsOptimized&quot;</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;LaunchTime&quot;</span><span class="fu">:</span> <span class="st">&quot;2016-11-15T21:51:33.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;PrivateIpAddress&quot;</span><span class="fu">:</span> <span class="st">&quot;172.31.10.195&quot;</span><span class="fu">,</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;ProductCodes&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;VpcId&quot;</span><span class="fu">:</span> <span class="st">&quot;vpc-ed37d589&quot;</span><span class="fu">,</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;StateTransitionReason&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;InstanceId&quot;</span><span class="fu">:</span> <span class="st">&quot;i-20d4ad04&quot;</span><span class="fu">,</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;ImageId&quot;</span><span class="fu">:</span> <span class="st">&quot;ami-a4175cc4&quot;</span><span class="fu">,</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;PrivateDnsName&quot;</span><span class="fu">:</span> <span class="st">&quot;ip-172-31-10-195.us-west-1.compute.internal&quot;</span><span class="fu">,</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;KeyName&quot;</span><span class="fu">:</span> <span class="st">&quot;bb5&quot;</span><span class="fu">,</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;SecurityGroups&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>                <span class="fu">{</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;GroupName&quot;</span><span class="fu">:</span> <span class="st">&quot;default&quot;</span><span class="fu">,</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;GroupId&quot;</span><span class="fu">:</span> <span class="st">&quot;sg-75c6d911&quot;</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>                <span class="fu">}</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>            <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;ClientToken&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;SubnetId&quot;</span><span class="fu">:</span> <span class="st">&quot;subnet-3b30f463&quot;</span><span class="fu">,</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;InstanceType&quot;</span><span class="fu">:</span> <span class="st">&quot;t2.nano&quot;</span><span class="fu">,</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;NetworkInterfaces&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a>                <span class="fu">{</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;Status&quot;</span><span class="fu">:</span> <span class="st">&quot;in-use&quot;</span><span class="fu">,</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;MacAddress&quot;</span><span class="fu">:</span> <span class="st">&quot;06:22:af:9d:2e:02&quot;</span><span class="fu">,</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;SourceDestCheck&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;VpcId&quot;</span><span class="fu">:</span> <span class="st">&quot;vpc-ed37d589&quot;</span><span class="fu">,</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;Description&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;NetworkInterfaceId&quot;</span><span class="fu">:</span> <span class="st">&quot;eni-47a45549&quot;</span><span class="fu">,</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;PrivateIpAddresses&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">{</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;PrivateDnsName&quot;</span><span class="fu">:</span> <span class="st">&quot;ip-172-31-10-195.us-west-1.compute.internal&quot;</span><span class="fu">,</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;Primary&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;PrivateIpAddress&quot;</span><span class="fu">:</span> <span class="st">&quot;172.31.10.195&quot;</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">}</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>                    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;PrivateDnsName&quot;</span><span class="fu">:</span> <span class="st">&quot;ip-172-31-10-195.us-west-1.compute.internal&quot;</span><span class="fu">,</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;Attachment&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">&quot;Status&quot;</span><span class="fu">:</span> <span class="st">&quot;attaching&quot;</span><span class="fu">,</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">&quot;DeviceIndex&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">&quot;DeleteOnTermination&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">&quot;AttachmentId&quot;</span><span class="fu">:</span> <span class="st">&quot;eni-attach-0114508d&quot;</span><span class="fu">,</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">&quot;AttachTime&quot;</span><span class="fu">:</span> <span class="st">&quot;2016-11-15T21:51:33.000Z&quot;</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">},</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;Groups&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">{</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;GroupName&quot;</span><span class="fu">:</span> <span class="st">&quot;default&quot;</span><span class="fu">,</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;GroupId&quot;</span><span class="fu">:</span> <span class="st">&quot;sg-75c6d911&quot;</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">}</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a>                    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;SubnetId&quot;</span><span class="fu">:</span> <span class="st">&quot;subnet-3b30f463&quot;</span><span class="fu">,</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;OwnerId&quot;</span><span class="fu">:</span> <span class="st">&quot;511122800347&quot;</span><span class="fu">,</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;PrivateIpAddress&quot;</span><span class="fu">:</span> <span class="st">&quot;172.31.10.195&quot;</span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a>                <span class="fu">}</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a>            <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;SourceDestCheck&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;Placement&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;Tenancy&quot;</span><span class="fu">:</span> <span class="st">&quot;default&quot;</span><span class="fu">,</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;GroupName&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;AvailabilityZone&quot;</span><span class="fu">:</span> <span class="st">&quot;us-west-1a&quot;</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;Hypervisor&quot;</span><span class="fu">:</span> <span class="st">&quot;xen&quot;</span><span class="fu">,</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;BlockDeviceMappings&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;Architecture&quot;</span><span class="fu">:</span> <span class="st">&quot;x86_64&quot;</span><span class="fu">,</span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;StateReason&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;Message&quot;</span><span class="fu">:</span> <span class="st">&quot;pending&quot;</span><span class="fu">,</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;Code&quot;</span><span class="fu">:</span> <span class="st">&quot;pending&quot;</span></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;RootDeviceName&quot;</span><span class="fu">:</span> <span class="st">&quot;/dev/sda1&quot;</span><span class="fu">,</span></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;VirtualizationType&quot;</span><span class="fu">:</span> <span class="st">&quot;hvm&quot;</span><span class="fu">,</span></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;AmiLaunchIndex&quot;</span><span class="fu">:</span> <span class="dv">0</span></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>On note le <code>"PublicDnsName": null</code>, ce qui signifie que
l’instance n’a pour le moment pas d’entrée DNS, puisqu’elle est en train
de se lance (statut <code>pending</code>).</p>
<h2 id="se-connecter-à-linstance">Se connecter à l’instance</h2>
<p>Quelques instants plus tard, nous allons redemander :</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws ec2 describe-instances <span class="at">--instance-ids</span> i-20d4ad04</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Reservations&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;OwnerId&quot;</span><span class="fu">:</span> <span class="st">&quot;511122800347&quot;</span><span class="fu">,</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;ReservationId&quot;</span><span class="fu">:</span> <span class="st">&quot;r-eaf7f258&quot;</span><span class="fu">,</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;Groups&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;Instances&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">{</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;Monitoring&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">&quot;State&quot;</span><span class="fu">:</span> <span class="st">&quot;disabled&quot;</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">},</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;PublicDnsName&quot;</span><span class="fu">:</span> <span class="st">&quot;ec2-52-53-162-123.us-west-1.compute.amazonaws.com&quot;</span><span class="fu">,</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;State&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">&quot;Code&quot;</span><span class="fu">:</span> <span class="dv">16</span><span class="fu">,</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">&quot;Name&quot;</span><span class="fu">:</span> <span class="st">&quot;running&quot;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">},</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;EbsOptimized&quot;</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;LaunchTime&quot;</span><span class="fu">:</span> <span class="st">&quot;2016-11-15T21:51:33.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;PublicIpAddress&quot;</span><span class="fu">:</span> <span class="st">&quot;52.53.162.123&quot;</span><span class="fu">,</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;PrivateIpAddress&quot;</span><span class="fu">:</span> <span class="st">&quot;172.31.10.195&quot;</span><span class="fu">,</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;ProductCodes&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;VpcId&quot;</span><span class="fu">:</span> <span class="st">&quot;vpc-ed37d589&quot;</span><span class="fu">,</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;StateTransitionReason&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;InstanceId&quot;</span><span class="fu">:</span> <span class="st">&quot;i-20d4ad04&quot;</span><span class="fu">,</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;ImageId&quot;</span><span class="fu">:</span> <span class="st">&quot;ami-a4175cc4&quot;</span><span class="fu">,</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;PrivateDnsName&quot;</span><span class="fu">:</span> <span class="st">&quot;ip-172-31-10-195.us-west-1.compute.internal&quot;</span><span class="fu">,</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;KeyName&quot;</span><span class="fu">:</span> <span class="st">&quot;bb5&quot;</span><span class="fu">,</span></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;SecurityGroups&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">{</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;GroupName&quot;</span><span class="fu">:</span> <span class="st">&quot;default&quot;</span><span class="fu">,</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;GroupId&quot;</span><span class="fu">:</span> <span class="st">&quot;sg-75c6d911&quot;</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">}</span></span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>                    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;ClientToken&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;SubnetId&quot;</span><span class="fu">:</span> <span class="st">&quot;subnet-3b30f463&quot;</span><span class="fu">,</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;InstanceType&quot;</span><span class="fu">:</span> <span class="st">&quot;t2.nano&quot;</span><span class="fu">,</span></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;NetworkInterfaces&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">{</span></span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;Status&quot;</span><span class="fu">:</span> <span class="st">&quot;in-use&quot;</span><span class="fu">,</span></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;MacAddress&quot;</span><span class="fu">:</span> <span class="st">&quot;06:22:af:9d:2e:02&quot;</span><span class="fu">,</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;SourceDestCheck&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;VpcId&quot;</span><span class="fu">:</span> <span class="st">&quot;vpc-ed37d589&quot;</span><span class="fu">,</span></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;Description&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;Association&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>                                <span class="dt">&quot;PublicIp&quot;</span><span class="fu">:</span> <span class="st">&quot;52.53.162.123&quot;</span><span class="fu">,</span></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>                                <span class="dt">&quot;PublicDnsName&quot;</span><span class="fu">:</span> <span class="st">&quot;ec2-52-53-162-123.us-west-1.compute.amazonaws.com&quot;</span><span class="fu">,</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>                                <span class="dt">&quot;IpOwnerId&quot;</span><span class="fu">:</span> <span class="st">&quot;amazon&quot;</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">},</span></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;NetworkInterfaceId&quot;</span><span class="fu">:</span> <span class="st">&quot;eni-47a45549&quot;</span><span class="fu">,</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;PrivateIpAddresses&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">{</span></span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>                                    <span class="dt">&quot;PrivateDnsName&quot;</span><span class="fu">:</span> <span class="st">&quot;ip-172-31-10-195.us-west-1.compute.internal&quot;</span><span class="fu">,</span></span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>                                    <span class="dt">&quot;Association&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>                                        <span class="dt">&quot;PublicIp&quot;</span><span class="fu">:</span> <span class="st">&quot;52.53.162.123&quot;</span><span class="fu">,</span></span>
<span id="cb13-55"><a href="#cb13-55" aria-hidden="true" tabindex="-1"></a>                                        <span class="dt">&quot;PublicDnsName&quot;</span><span class="fu">:</span> <span class="st">&quot;ec2-52-53-162-123.us-west-1.compute.amazonaws.com&quot;</span><span class="fu">,</span></span>
<span id="cb13-56"><a href="#cb13-56" aria-hidden="true" tabindex="-1"></a>                                        <span class="dt">&quot;IpOwnerId&quot;</span><span class="fu">:</span> <span class="st">&quot;amazon&quot;</span></span>
<span id="cb13-57"><a href="#cb13-57" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">},</span></span>
<span id="cb13-58"><a href="#cb13-58" aria-hidden="true" tabindex="-1"></a>                                    <span class="dt">&quot;Primary&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb13-59"><a href="#cb13-59" aria-hidden="true" tabindex="-1"></a>                                    <span class="dt">&quot;PrivateIpAddress&quot;</span><span class="fu">:</span> <span class="st">&quot;172.31.10.195&quot;</span></span>
<span id="cb13-60"><a href="#cb13-60" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">}</span></span>
<span id="cb13-61"><a href="#cb13-61" aria-hidden="true" tabindex="-1"></a>                            <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb13-62"><a href="#cb13-62" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;PrivateDnsName&quot;</span><span class="fu">:</span> <span class="st">&quot;ip-172-31-10-195.us-west-1.compute.internal&quot;</span><span class="fu">,</span></span>
<span id="cb13-63"><a href="#cb13-63" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;Attachment&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb13-64"><a href="#cb13-64" aria-hidden="true" tabindex="-1"></a>                                <span class="dt">&quot;Status&quot;</span><span class="fu">:</span> <span class="st">&quot;attached&quot;</span><span class="fu">,</span></span>
<span id="cb13-65"><a href="#cb13-65" aria-hidden="true" tabindex="-1"></a>                                <span class="dt">&quot;DeviceIndex&quot;</span><span class="fu">:</span> <span class="dv">0</span><span class="fu">,</span></span>
<span id="cb13-66"><a href="#cb13-66" aria-hidden="true" tabindex="-1"></a>                                <span class="dt">&quot;DeleteOnTermination&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb13-67"><a href="#cb13-67" aria-hidden="true" tabindex="-1"></a>                                <span class="dt">&quot;AttachmentId&quot;</span><span class="fu">:</span> <span class="st">&quot;eni-attach-0114508d&quot;</span><span class="fu">,</span></span>
<span id="cb13-68"><a href="#cb13-68" aria-hidden="true" tabindex="-1"></a>                                <span class="dt">&quot;AttachTime&quot;</span><span class="fu">:</span> <span class="st">&quot;2016-11-15T21:51:33.000Z&quot;</span></span>
<span id="cb13-69"><a href="#cb13-69" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">},</span></span>
<span id="cb13-70"><a href="#cb13-70" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;Groups&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb13-71"><a href="#cb13-71" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">{</span></span>
<span id="cb13-72"><a href="#cb13-72" aria-hidden="true" tabindex="-1"></a>                                    <span class="dt">&quot;GroupName&quot;</span><span class="fu">:</span> <span class="st">&quot;default&quot;</span><span class="fu">,</span></span>
<span id="cb13-73"><a href="#cb13-73" aria-hidden="true" tabindex="-1"></a>                                    <span class="dt">&quot;GroupId&quot;</span><span class="fu">:</span> <span class="st">&quot;sg-75c6d911&quot;</span></span>
<span id="cb13-74"><a href="#cb13-74" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">}</span></span>
<span id="cb13-75"><a href="#cb13-75" aria-hidden="true" tabindex="-1"></a>                            <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb13-76"><a href="#cb13-76" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;SubnetId&quot;</span><span class="fu">:</span> <span class="st">&quot;subnet-3b30f463&quot;</span><span class="fu">,</span></span>
<span id="cb13-77"><a href="#cb13-77" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;OwnerId&quot;</span><span class="fu">:</span> <span class="st">&quot;511122800347&quot;</span><span class="fu">,</span></span>
<span id="cb13-78"><a href="#cb13-78" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;PrivateIpAddress&quot;</span><span class="fu">:</span> <span class="st">&quot;172.31.10.195&quot;</span></span>
<span id="cb13-79"><a href="#cb13-79" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">}</span></span>
<span id="cb13-80"><a href="#cb13-80" aria-hidden="true" tabindex="-1"></a>                    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb13-81"><a href="#cb13-81" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;SourceDestCheck&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb13-82"><a href="#cb13-82" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;Placement&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb13-83"><a href="#cb13-83" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">&quot;Tenancy&quot;</span><span class="fu">:</span> <span class="st">&quot;default&quot;</span><span class="fu">,</span></span>
<span id="cb13-84"><a href="#cb13-84" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">&quot;GroupName&quot;</span><span class="fu">:</span> <span class="st">&quot;&quot;</span><span class="fu">,</span></span>
<span id="cb13-85"><a href="#cb13-85" aria-hidden="true" tabindex="-1"></a>                        <span class="dt">&quot;AvailabilityZone&quot;</span><span class="fu">:</span> <span class="st">&quot;us-west-1a&quot;</span></span>
<span id="cb13-86"><a href="#cb13-86" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">},</span></span>
<span id="cb13-87"><a href="#cb13-87" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;Hypervisor&quot;</span><span class="fu">:</span> <span class="st">&quot;xen&quot;</span><span class="fu">,</span></span>
<span id="cb13-88"><a href="#cb13-88" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;BlockDeviceMappings&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb13-89"><a href="#cb13-89" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">{</span></span>
<span id="cb13-90"><a href="#cb13-90" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;DeviceName&quot;</span><span class="fu">:</span> <span class="st">&quot;/dev/sda1&quot;</span><span class="fu">,</span></span>
<span id="cb13-91"><a href="#cb13-91" aria-hidden="true" tabindex="-1"></a>                            <span class="dt">&quot;Ebs&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb13-92"><a href="#cb13-92" aria-hidden="true" tabindex="-1"></a>                                <span class="dt">&quot;Status&quot;</span><span class="fu">:</span> <span class="st">&quot;attached&quot;</span><span class="fu">,</span></span>
<span id="cb13-93"><a href="#cb13-93" aria-hidden="true" tabindex="-1"></a>                                <span class="dt">&quot;DeleteOnTermination&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb13-94"><a href="#cb13-94" aria-hidden="true" tabindex="-1"></a>                                <span class="dt">&quot;VolumeId&quot;</span><span class="fu">:</span> <span class="st">&quot;vol-20f9029f&quot;</span><span class="fu">,</span></span>
<span id="cb13-95"><a href="#cb13-95" aria-hidden="true" tabindex="-1"></a>                                <span class="dt">&quot;AttachTime&quot;</span><span class="fu">:</span> <span class="st">&quot;2016-11-15T21:51:34.000Z&quot;</span></span>
<span id="cb13-96"><a href="#cb13-96" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">}</span></span>
<span id="cb13-97"><a href="#cb13-97" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">}</span></span>
<span id="cb13-98"><a href="#cb13-98" aria-hidden="true" tabindex="-1"></a>                    <span class="ot">]</span><span class="fu">,</span></span>
<span id="cb13-99"><a href="#cb13-99" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;Architecture&quot;</span><span class="fu">:</span> <span class="st">&quot;x86_64&quot;</span><span class="fu">,</span></span>
<span id="cb13-100"><a href="#cb13-100" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;RootDeviceType&quot;</span><span class="fu">:</span> <span class="st">&quot;ebs&quot;</span><span class="fu">,</span></span>
<span id="cb13-101"><a href="#cb13-101" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;RootDeviceName&quot;</span><span class="fu">:</span> <span class="st">&quot;/dev/sda1&quot;</span><span class="fu">,</span></span>
<span id="cb13-102"><a href="#cb13-102" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;VirtualizationType&quot;</span><span class="fu">:</span> <span class="st">&quot;hvm&quot;</span><span class="fu">,</span></span>
<span id="cb13-103"><a href="#cb13-103" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">&quot;AmiLaunchIndex&quot;</span><span class="fu">:</span> <span class="dv">0</span></span>
<span id="cb13-104"><a href="#cb13-104" aria-hidden="true" tabindex="-1"></a>                <span class="fu">}</span></span>
<span id="cb13-105"><a href="#cb13-105" aria-hidden="true" tabindex="-1"></a>            <span class="ot">]</span></span>
<span id="cb13-106"><a href="#cb13-106" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb13-107"><a href="#cb13-107" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb13-108"><a href="#cb13-108" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Et Bam ! la machine est prête (statut “running”). Notons le DNS
public (pour nous c’est
<code>ec2-52-53-162-123.us-west-1.compute.amazonaws.com</code>).</p>
<p>Attention aux machines des petits camarades. Vous les verrez :)</p>
<p>Normalement, nous avons maintenant tout ce qu’il faut pour nous
connecter à notre toute première instance en SSH. Chaque système a ses
petites habitudes. Sous ubuntu, c’est l’user ubuntu qui doit se
connecter.</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ssh ubuntu@ec2-52-53-162-123.us-west-1.compute.amazonaws.com <span class="at">-i</span> my-key-pair.pem <span class="at">-v</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@ip-172-31-10-195:~$</span></span></code></pre></div>
<p>On peut en lancer une deuxième, une troisième … La commande
describe-instances nous fournira les informations de ces instances.</p>
<p>Depuis l’instance on peut récupérer un certain nombre d’information :
les meta-data</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@ip-172-31-10-195:~$</span> curl http://169.254.169.254/latest/meta-data/</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="ex">ami-id</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="ex">ami-launch-index</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="ex">ami-manifest-path</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="ex">block-device-mapping/</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hostname</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="ex">instance-action</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="ex">instance-id</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="ex">instance-type</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="ex">kernel-id</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="ex">local-hostname</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="ex">local-ipv4</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="ex">mac</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="ex">metrics/</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="ex">network/</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="ex">placement/</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="ex">profile</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="ex">public-hostname</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="ex">public-ipv4</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="ex">public-keys/</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="ex">reservation-id</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="ex">security-groups</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="ex">services/</span></span></code></pre></div>
<p>Enfin, on est sudo…</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">ubuntu@ip-172-31-37-163:~$</span> sudo apt-get update</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span></code></pre></div>
<h2
id="automatiser-linstallation-des-services-au-lancement-de-linstance">Automatiser
l’installation des services au lancement de l’instance</h2>
<p>On a pour le moment été capable de lancer une instance, et de s’y
connecter. Un fois dessus, on peut manuellement installer ce que l’on
veut, comme sur n’importe quelle machine.</p>
<p>Par exemple :</p>
<ul>
<li>installer l’écosystème du langage/framework qu’il nous faut</li>
<li>git clone notre super projet</li>
<li>regler 2-3 paramètres + fichiers de configuration</li>
<li>lancer les services</li>
</ul>
<p>Ainsi, tout s’installe et se lance, dès que l’instance est
lancée.</p>
<p>Un tel script de lancement s’écrit dans le fichier
<code>user-data</code> que l’on peut passer en paramètre à la commande
<code>aws ec2 run-instance ..... --user-data file://user-data-file</code>.</p>
<p>Un exemple dans un écosystème node.js à jour :</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> update</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> install git curl sudo <span class="at">-y</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">-sL</span> https://deb.nodesource.com/setup_6.x <span class="kw">|</span> <span class="fu">sudo</span> bash <span class="at">-</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="ex">apt-get</span> <span class="at">-y</span> install python build-essential nodejs</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install pm2 <span class="at">-g</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /home/ubuntu/</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">git</span> clone git://github.com/MY_NAME/MY_PROJECT.git</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> MY_PROJECT</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span> <span class="op">&gt;&gt;</span> config/config.json <span class="op">&lt;&lt; EOD</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="st">var conf = {</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="st">    &#39;maVariable&#39;: 1</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="op">EOD</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="ex">npm</span> install .</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="bu">ulimit</span> <span class="at">-n</span> 102400</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="va">PORT</span><span class="op">=</span>80 <span class="va">NODE_ENV</span><span class="op">=</span>production <span class="ex">pm2</span> start app.js</span></code></pre></div>
<p>D’autres examples dans la doc : <a
href="https://docs.aws.amazon.com/fr_fr/AWSEC2/latest/UserGuide/user-data.html"
class="uri">https://docs.aws.amazon.com/fr_fr/AWSEC2/latest/UserGuide/user-data.html</a></p>
<h2 id="stopper-une-instance">Stopper une instance</h2>
<div class="sourceCode" id="cb18"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws ec2 stop-instance <span class="at">--instance-id</span> i-20d4ad04</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;StoppingInstances&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;InstanceId&quot;</span><span class="fu">:</span> <span class="st">&quot;i-20d4ad04&quot;</span><span class="fu">,</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;CurrentState&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;Code&quot;</span><span class="fu">:</span> <span class="dv">64</span><span class="fu">,</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;Name&quot;</span><span class="fu">:</span> <span class="st">&quot;stopping&quot;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;PreviousState&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;Code&quot;</span><span class="fu">:</span> <span class="dv">16</span><span class="fu">,</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;Name&quot;</span><span class="fu">:</span> <span class="st">&quot;running&quot;</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="terminer-une-instance">Terminer une instance</h2>
<div class="sourceCode" id="cb20"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws ec2 terminate-instances <span class="at">--instance-id</span> i-20d4ad04</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;TerminatingInstances&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;InstanceId&quot;</span><span class="fu">:</span> <span class="st">&quot;i-20d4ad04&quot;</span><span class="fu">,</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;CurrentState&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;Code&quot;</span><span class="fu">:</span> <span class="dv">32</span><span class="fu">,</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;Name&quot;</span><span class="fu">:</span> <span class="st">&quot;shutting-down&quot;</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">},</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;PreviousState&quot;</span><span class="fu">:</span> <span class="fu">{</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;Code&quot;</span><span class="fu">:</span> <span class="dv">64</span><span class="fu">,</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                <span class="dt">&quot;Name&quot;</span><span class="fu">:</span> <span class="st">&quot;stopping&quot;</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">}</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="mumuse-avec-les-ebs-elasctic-block-storage">Mumuse avec les EBS
(Elasctic Block Storage)</h2>
<p>Nos t2.micro sont en EBS-root : il n’y a qu’un volume, et c’est / (le
root). Impossible donc de le démonter On va créer un nouveau volume.</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws ec2 create-volume <span class="at">--size</span> 100 <span class="at">--availability-zone</span> us-west-1d</span></code></pre></div>
<div class="sourceCode" id="cb23"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;AvailabilityZone&quot;</span><span class="fu">:</span> <span class="st">&quot;us-west-1d&quot;</span><span class="fu">,</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Attachments&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Tags&quot;</span><span class="fu">:</span> <span class="ot">[]</span><span class="fu">,</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Encrypted&quot;</span><span class="fu">:</span> <span class="kw">false</span><span class="fu">,</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;VolumeType&quot;</span><span class="fu">:</span> <span class="st">&quot;standard&quot;</span><span class="fu">,</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;VolumeId&quot;</span><span class="fu">:</span> <span class="st">&quot;vol-99922fd6&quot;</span><span class="fu">,</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;State&quot;</span><span class="fu">:</span> <span class="st">&quot;creating&quot;</span><span class="fu">,</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;SnapshotId&quot;</span><span class="fu">:</span> <span class="kw">null</span><span class="fu">,</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;CreateTime&quot;</span><span class="fu">:</span> <span class="st">&quot;2014-09-16T08:23:40.498Z&quot;</span><span class="fu">,</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Size&quot;</span><span class="fu">:</span> <span class="dv">100</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>On peut alors remonter cet EBS sur la deuxième instance.</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws ec2 attach-volume <span class="at">--instance-id</span> i-abcd1234 <span class="at">--volume-id</span> vol-99922fd6 <span class="at">--device</span> /dev/sdf</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;AttachTime&quot;</span><span class="fu">:</span> <span class="st">&quot;2014-09-12T15:26:13.000Z&quot;</span><span class="fu">,</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;InstanceId&quot;</span><span class="fu">:</span> <span class="st">&quot;i-abcd1234&quot;</span><span class="fu">,</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;VolumeId&quot;</span><span class="fu">:</span> <span class="st">&quot;vol-99922fd6&quot;</span><span class="fu">,</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;State&quot;</span><span class="fu">:</span> <span class="st">&quot;attaching&quot;</span><span class="fu">,</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Device&quot;</span><span class="fu">:</span> <span class="st">&quot;/dev/sdf&quot;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<h2 id="elastic-load-balancer">Elastic Load Balancer</h2>
<p>On déclare un ELB nommé upicardie-asdemo1 sur la zone us-west-1d, qui
écoute sur le port 80 et qui répartit les requêtes sur le port 80 des
instances. Notre compte AWS est en mode VPC, nous allons devoir utiliser
les subnets VPC pour initialiser le load balancer.</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws ec2  describe-subnets</span></code></pre></div>
<div class="sourceCode" id="cb27"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;Subnets&quot;</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;VpcId&quot;</span><span class="fu">:</span> <span class="st">&quot;vpc-ab8e3dce&quot;</span><span class="fu">,</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;CidrBlock&quot;</span><span class="fu">:</span> <span class="st">&quot;172.31.16.0/20&quot;</span><span class="fu">,</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;MapPublicIpOnLaunch&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;DefaultForAz&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;State&quot;</span><span class="fu">:</span> <span class="st">&quot;available&quot;</span><span class="fu">,</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;AvailabilityZone&quot;</span><span class="fu">:</span> <span class="st">&quot;us-west-1a&quot;</span><span class="fu">,</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;SubnetId&quot;</span><span class="fu">:</span> <span class="st">&quot;subnet-19c2126e&quot;</span><span class="fu">,</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;AvailableIpAddressCount&quot;</span><span class="fu">:</span> <span class="dv">4089</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;VpcId&quot;</span><span class="fu">:</span> <span class="st">&quot;vpc-ab8e3dce&quot;</span><span class="fu">,</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;CidrBlock&quot;</span><span class="fu">:</span> <span class="st">&quot;172.31.32.0/20&quot;</span><span class="fu">,</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;MapPublicIpOnLaunch&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;DefaultForAz&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;State&quot;</span><span class="fu">:</span> <span class="st">&quot;available&quot;</span><span class="fu">,</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;AvailabilityZone&quot;</span><span class="fu">:</span> <span class="st">&quot;us-west-1d&quot;</span><span class="fu">,</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;SubnetId&quot;</span><span class="fu">:</span> <span class="st">&quot;subnet-3f0e1c17&quot;</span><span class="fu">,</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;AvailableIpAddressCount&quot;</span><span class="fu">:</span> <span class="dv">4087</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span><span class="ot">,</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">{</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;VpcId&quot;</span><span class="fu">:</span> <span class="st">&quot;vpc-ab8e3dce&quot;</span><span class="fu">,</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;CidrBlock&quot;</span><span class="fu">:</span> <span class="st">&quot;172.31.0.0/20&quot;</span><span class="fu">,</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;MapPublicIpOnLaunch&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;DefaultForAz&quot;</span><span class="fu">:</span> <span class="kw">true</span><span class="fu">,</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;State&quot;</span><span class="fu">:</span> <span class="st">&quot;available&quot;</span><span class="fu">,</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;AvailabilityZone&quot;</span><span class="fu">:</span> <span class="st">&quot;us-west-1b&quot;</span><span class="fu">,</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;SubnetId&quot;</span><span class="fu">:</span> <span class="st">&quot;subnet-d9bd4f80&quot;</span><span class="fu">,</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>            <span class="dt">&quot;AvailableIpAddressCount&quot;</span><span class="fu">:</span> <span class="dv">4091</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">}</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws elb create-load-balancer <span class="dt">\</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--load-balancer-name</span> upicardie-asdemo1 <span class="dt">\</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--subnets</span> subnet-d9bd4f80 subnet-3f0e1c17 subnet-19c2126e <span class="dt">\</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">--listeners</span> <span class="st">&quot;LoadBalancerPort=80,InstancePort=80,Protocol=http&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&quot;DNSName&quot;</span><span class="fu">:</span> <span class="st">&quot;upicardie-asdemo1-2087259529.us-west-1.elb.amazonaws.com&quot;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre></div>
<p>Attachons-lui les 2 instances que nous avons créées.</p>
<div class="sourceCode" id="cb30"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws elb register-instances-with-load-balancer <span class="dt">\</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">--load-balancer-name</span> upicardie-asdemo1 <span class="dt">\</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">--instances</span> i-a0eccdc1 i-a0eccda1</span></code></pre></div>
<h2 id="exercice">Exercice</h2>
<p>Installer un site web quelconque sur 3 instances, rattachées à un
ELB. Lancer un test de charge naif (ou pas) afin d’observer les logs sur
chaque machine.</p>
<h2 id="la-même-chose-en-console-web-ouf">La même chose en console WEB
(ouf!)</h2>
<p>Amazon est un des pioniers du Web. Il aurait été étonnant de ne pas
avoir une façon plus visuelle d’utiliser les services d’AWS.</p>
<p>C’est possible à l’addresse : <a
href="https://aws.amazon.com/console/"
class="uri">https://aws.amazon.com/console/</a></p>
<p>Mais vous allez devoir vous créer votre login</p>
<div class="sourceCode" id="cb31"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws iam create-login-profile help</span></code></pre></div>
<p>Regarder aussi</p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> aws iam get-account-password-policy</span></code></pre></div>
<hr />
<h4 id="licence">Licence</h4>
<p>Cette œuvre est mise à disposition selon les termes de la Licence <a
href="https://creativecommons.org/licenses/by/3.0/fr/">Creative Commons
Attribution 3.0 France</a>.</p>
<p><a href="https://creativecommons.org/licenses/by/3.0/fr/"><img
src="https://i.creativecommons.org/l/by/3.0/fr/88x31.png"
alt="Licence Creative Commons" /></a></p>
</body>
</html>
